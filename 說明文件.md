# 毒GPS說明文件

## 基本介紹

- 前提條件:
  - 需要安裝node.js 取得npm套件管理系統
  - 本系統使用react native 搭配expo開發
  - expo是什麼可以參考 [為什麼要用 Expo](https://ithelp.ithome.com.tw/articles/10190720)
- 引入套件(可以在package.json裡面查看)
  - expo相關

    - expo-location(取得經緯度)

    <!-- - expo-status-bar -->
  - react native 功能相關

    - react-native-safe-are-context(保留手機基本資訊)
    - react-native-map(目前沒有再使用)
    - react-native-webview
    - react-redux
    - reduxjs/toolkit (管理react-redux 簡化代碼)
    - react-navigtion/bottom-tabs
    - react-navigation/native
    - react-navigation/native-stack
  - css相關

    - nativewin (因為懶得寫css物件 所以使用這個套件><)
    - react-native-paper
    - expo/vetor-icon
    - rneui/base
    - rneui/themed
  - axios(串接api)
  - rn-agmcaptchalite ( 參考[驗證碼功能套件](https://www.npmjs.com/package/rn-agmcaptchalite))
  - **注意** :當使用[taiwindcss](https://tailwindcss.com/docs/installation) 需要再tailwind.config裡面去新增所有所支援的檔案

## 檔案結構

- expo

  - 一些配置和設定文件,通常是Expo Cli 在初始化時所建立
- Img

  - 放一些靜態共用圖片
- Navigation

  - 路由相關功能
- node_modules

  - 放專案依賴的文件,通常用npm安裝
- src

  - 裡面就是code主要撰寫區域 包含這專案幾大功能

  1. 登入頁面
  2. 最新消息
  3. 運送通報
  4. 表單查詢
  5. 緊急通報
  6. 車輛初審
- App.js

  - 這是應用程式主要目錄但我們用Navigiton去實驗路由功能

## 登入資訊

- 帳號:G0000001
- 車輛:ABC-001
- 密碼:cindy701

## 以下環境問題對應解法

- CommandError: [Network] request to https://api.expo.dev/graphql failed, reason: unable to verify the first certificate

  - cmd輸入這段
    **`set NODE_TLS_REJECT_UNAUTHORIZED=0`**
    **Note:在powershell底下執行無效 需要在cmd中**
- 如果是在npm install時就報錯可以嘗試

  - **`config set strict-ssl false`**
- 如果在建置時找不到java

  - 錯誤1: 在VSCode中設定的**JAVA_HOME**環境變數指向了錯誤的路徑
  - 解法: 在VSCode中,按下**Ctrl+Shift+P**打開命令選擇區,然後輸入 **`settings.json`** 並選擇**Preferences: Open Setting(JSON)**. 這會開啟**settings.json**檔案 之後再**settings.json**新增或修改以下設定

```bash
  "terminal.integrated.env.windows":{
  "JAVA_HOME":"正確的 JDK 路徑"
  }
```

- 錯誤2: 根本沒有設定JDK環境變數或者抓不到JDK環境變數
- 解法: 打開本機 檢視進階系統設定 ->進階->環境變數->{可以看到一個是User的使用者變數跟系統變數 (我都有新增)}
  點新增 (以筆者為例)變數名稱:**JAVA_HOME** 變數值 `"C:\Program Files\Java\jdk-21"`
- 錯誤訊息: SDK location not found. Define a valid SDK location with an **ANDROID_HOME environment**variable or by setting the sdk.dir path in your project's local properties file at   'C:\Users\User\Desktop\React\PoisonG\android\local.properties'.

  - 解法[參考](https://stackoverflow.com/questions/32634352/react-native-android-build-failed-sdk-location-not-found): 去這邊 `android/ directory of your react-native project`建立一個檔案叫**local.properties** 有兩種作業系統對應到不同的輸入:
  - **MacOs** : **`sdk.dir = /Users/USERNAME/Library/Android/sdk`**
  - **Windows** : **`sdk.dir = C:\\Users\\USERNAME\\AppData\\Local\\Android\\sdk`**
- 如果把檔案移到IOS中卻跑不起來出現下面錯誤

  - Use process(css).then(cb) to work with async plugins
  - 解法:
    移除 nativewind 輸入指令 **`npm uninstall nativewind `**
    移除 tailwindcss 輸入指令 **`npm uninstall tailwindcss`**
    重裝 tailwind 輸入指令 **`npm install --save-dev tailwindcss@3.3.2 `**
    重裝 nativewind 輸入指令 **`npm install nativewind `**

## Reducer

- FunctionThatManagerChangesToAnObject
- 甚麼是reducer?

## EAS部屬

- 待更新

## 原生部屬

### Android部屬

- 因為我們都是用expo去開發,但是當需要去原生部屬的時候,需要編譯成對應到adroid的sourse code,
  像是java?
  所以我們需要用到**gradle**這個工具 它可以幫我們建構項目

#### 實作流程

- 在你的項目中先去執行 `npx expo prebuild`

```bash
  $npx expo prebuild

```

- 可以看到在項目中會出現一個叫**android**資料夾然後
- `cd android` 移動到android資料夾下
- `$./gradlew assembleRelease` (記得要用 PowerShell 類型的命令介面)
- 等他成功後
- `C:\Users\User\Desktop\React\PoisonG\android\app\build\outputs\apk\release`去到這裡可以看到有一個生成的apk檔案

### IOS部屬

- 當你的android可以成功打包後把原本的**source code**

#### 程式除錯

- 為什麼當我使用Expo 的 `getCurrentPositionAsync`方法在ios下可以得到變化的經緯度但在Android中卻得不到 原因:
  **`Location.getCurrentPositionAsync({accuracy:Location.Accuracy.Highest});`**我猜是因為expoAPI 跟android搭配時他的默認值是低經緯度,但跟ios時默認是高經緯度.
- \Users\User\Desktop\React\PoisonG\android\gradlew.bat exited with non-zero code: 1
  https://stackoverflow.com/questions/32634352/react-native-android-build-failed-sdk-location-not-found
- startLocationUpdatesAsync
  去android/app/src/main/AndroidManifest.xml 新增

  [uses-permissionandroid:name=&#34;android.permission.ACCESS_BACKGROUND_LOCATION&#34;/](uses-permissionandroid:name=%22android.permission.ACCESS_BACKGROUND_LOCATION%22/)

  [uses-permissionandroid:name=&#34;android.permission.FOREGROUND_SERVICE&#34;/](uses-permissionandroid:name=%22android.permission.FOREGROUND_SERVICE%22/)
